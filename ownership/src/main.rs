/*
ç”±äºè®¡ç®—æœºçš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå› æ­¤ä¸€ä¸ªç¨‹åºéœ€è¦ç®¡ç†å¥½å†…å­˜ï¼Œé¿å…èµ„æºå ç”¨è¿‡é«˜å’Œå†…å­˜æ³„æ¼

æœ‰äº›è¯­è¨€æ˜¯æœ‰ gc ç®¡ç†å†…å­˜ï¼Œä¾‹å¦‚ java/go
ä¼˜ç‚¹ï¼šç¨‹åºå‘˜ä¸ç”¨æ“è¡Œå†…å­˜ç®¡ç†ï¼Œé€‚åˆå†™ä¸šåŠ¡ç³»ç»Ÿ
ç¼ºç‚¹:
- æœ¬èº«æ¯”è¾ƒåƒå†…å­˜
- åœ¨è¿è¡Œ gc ä¼šå¯¼è‡´å»¶è¿Ÿ
- gc è§¦å‘çš„æ—¶æœºä¸å¯é¢„æµ‹
- å†…å­˜å¯èƒ½ä¸ä¼šåœ¨ç¬¬ä¸€æ—¶é—´è¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆå†…å­˜åˆ©ç”¨ç‡å°±ä¸é«˜

æœ‰äº›è¯­è¨€éœ€è¦ç¨‹åºç¼–å†™è€…è‡ªå·±ç®¡ç†å†…å­˜é‡Šæ”¾ï¼Œä¾‹å¦‚ c/c++
ä¼˜ç‚¹ï¼šå¯ä»¥å¯¹ç¨‹åºçš„å†…å­˜ç®¡ç†æœ‰æœ€ç²¾ç»†çš„æ§åˆ¶ï¼Œé€‚åˆç¼–å†™å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„æ¨¡å—
ç¼ºç‚¹:
- ç»å¸¸ä¼šçŠ¯å¿˜è®°é‡Šæ”¾å†…å­˜ï¼Œå¯¹ä¸€å—å†…å­˜é‡å¤é‡Šæ”¾ï¼Œè®¿é—®ç©ºæŒ‡é’ˆç­‰é—®é¢˜ï¼Œä¸è¿‡ c++ çš„æ™ºèƒ½æŒ‡é’ˆå¯ä»¥ä¸€å®šç¨‹åº¦ç¼“è§£è¿™äº›é—®é¢˜
- ä¸€æ—¦å‘ç”Ÿé”™è¯¯çš„å†…å­˜è®¿é—®å’Œå†…å­˜æ³„æ¼ï¼Œå¯¹äºåº”ç”¨å’Œç³»ç»Ÿå¯èƒ½æ˜¯è‡´å‘½çš„
- æ‰‹åŠ¨ç®¡ç†å†…å­˜å¤ªè´¹è„‘

rust æ²¡æœ‰é‡‡ç”¨ gc, ä¹Ÿæ²¡æœ‰å®Œå…¨æŠŠç®¡ç†å†…å­˜çš„è´£ä»»ä¸¢ç»™ç¨‹åºå‘˜ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å¦å¤–çš„æ–¹å¼ï¼šæ‰€æœ‰æƒæœºåˆ¶
rust æœ€å¤§è¯­è¨€ç‰¹è‰²å°±æ˜¯æ‰€æœ‰æƒæœºåˆ¶ï¼Œè¿è¡Œæ—¶é›¶å¼€é”€ï¼Œç¼–è¯‘æœŸé—´å°±èƒ½æ£€æŸ¥å‡ºå†…å­˜å®‰å…¨é—®é¢˜
*/

#[allow(unused)]

fn main() {
    // ------------------------ æ ˆå†…å­˜ä¸å †å†…å­˜ -----------------------------
    /*
    å­˜æ”¾å†…å®¹ï¼š
    æ ˆå†…å­˜ï¼šç”¨äºå­˜æ”¾å¤§å°å·²çŸ¥ä¸”å¤§å°å›ºå®šçš„å€¼ï¼Œåè¿›å…ˆå‡º
    å †å†…å­˜ï¼šç”¨äºå­˜æ”¾å¤§å°æœªçŸ¥æˆ–å¤§å°ä¸å›ºå®šçš„å€¼

    å†…å­˜ä¸­çš„å­˜åœ¨å½¢å¼:
     - æ ˆå†…å­˜å€¼æ˜¯è¿ç»­å­˜æ”¾çš„ï¼Œåè¿›å…ˆå‡º
     - å †å†…å­˜åœ¨å†…å­˜æ˜¯ä¸è¿ç»­ï¼Œæ•£ä¹±çš„ï¼Œè®¿é—®ä¸€ä¸ªå †å†…å­˜çš„å€¼å¯èƒ½éœ€è¦åœ¨å†…å­˜ä¸­å¤šæ¬¡è·³è½¬è®¿é—®

    åˆ†é…å†…å­˜é€Ÿåº¦ï¼š
     - æ ˆæ›´å¿«ï¼Œå› ä¸ºå°±æ˜¯æ”¾æ ˆé¡¶ï¼Œä½ç½®å›ºå®š
     - å †æ›´æ…¢ï¼šå› ä¸ºéœ€è¦å…ˆå‘ç³»ç»Ÿç”³è¯·å†…å­˜ä¸­æ²¡æœ‰è¢«ä½¿ç”¨çš„ä¸€å—å¤§å°è¶³å¤Ÿçš„å†…å­˜ï¼Œæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå†æ¸…ç†é‚£å—å†…å­˜

    è®¿é—®é€Ÿåº¦ï¼š
     - æ ˆå†…å­˜æ›´å¿«ï¼Œå› ä¸ºå†…å­˜è¿ç»­
     - å †å†…å­˜æ›´æ…¢ï¼Œå› ä¸ºå¯èƒ½éœ€è¦å¤šæ¬¡è·³è½¬
    */

    // ------------------------ æ‰€æœ‰æƒè§„åˆ™ -----------------------------
    // Each value in Rust has a variable that called it's owner
    // There can only be one owner at a time
    // When the owner goes out of scoop, the value will be dropped

    // ------------------------ str å’Œ String ç±»å‹ -----------------------------
    // å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæ‰€ä»¥æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå†…å®¹å’Œå¤§å°éƒ½ä¸å¯å˜çš„ï¼Œç±»å‹åæ˜¯ str
    let str = "å­—ç¬¦ä¸²å­—é¢é‡";

    // String ç±»å‹å†…å­˜æ˜¯å†…å®¹å’Œå¤§å°éƒ½å¯å˜çš„ï¼Œæ”¾åœ¨é˜Ÿå†…å­˜ä¸Š
    let string = String::from("String ç±»å‹å®ä¾‹");

    // ------------------------ ç§»åŠ¨ -----------------------------
    // å£°æ˜ä¸å¯å˜å˜é‡ xï¼Œå¹¶ä½¿ç”¨ i32 ç±»å‹çš„ 5 åˆå§‹åŒ– xï¼Œå°† 5 å‹å…¥æ ˆå†…å­˜
    let x = 5;
    // å¤åˆ¶ x æŒ‡å‘çš„æ ˆå†…å­˜ï¼Œå†å‹å…¥æ ˆå†…å­˜
    let y = x;

    // ç”³è¯·äº†æ ˆå†…å­˜å­˜æ”¾ s1 çš„æˆå‘˜
    // ç”³è¯·å †å†…å­˜å­˜æ”¾ s1.ptr æŒ‡å‘çš„å­—ç¬¦ä¸²å­—èŠ‚
    // s1 çš„é•¿åº¦è¡¨ç¤ºçš„æ˜¯å­—ç¬¦ä¸²å†…å®¹çš„é•¿åº¦ï¼Œå®¹é‡è¡¨ç¤ºç”³è¯·çš„å†…å­˜å¤§å°ï¼Œå’Œ c++ çš„ vector ä¸€æ ·ï¼Œå®¹é‡æ˜¯ä¼šåŠ¨æ€è°ƒèŠ‚çš„
    let s1 = String::from("hello");
    // åœ¨ js, java ç­‰è¯­è¨€æˆ‘ä»¬ä¼šç§°ä¹‹ä¸ºæµ…æ‹·è´ï¼Œåªæ˜¯å¼•ç”¨å¤åˆ¶ï¼ŒæŒ‡å‘çš„å†…å­˜æ²¡æœ‰è¢«å¤åˆ¶
    // ä¸åŒçš„æ˜¯ç”±äºæ‰€æœ‰æƒè§„åˆ™ç¬¬äºŒæ¡ï¼Œä¸€ä¸ªæ—¶åˆ»ä¸€ä¸ªå€¼åªæœ‰ä¸€ä¸ª ownerï¼Œè¿™é‡Œçš„ s1 å…¶å®ä¼šå¤±æ•ˆï¼Œs2 å˜æˆ owner
    // è¿™ç§è¡Œä¸ºå« moveï¼Œmove å…¶å®è¿˜ç¡®ä¿äº†å¤šä¸ªå˜é‡æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œç¦»å¼€ä½œç”¨åŸŸæ—¶ä¸ä¼šå¤šæ¬¡é‡Šæ”¾
    let s2 = s1;
    // æŠ¥é”™ï¼šå€Ÿç”¨äº†å·²ç»è¢«ç§»åŠ¨çš„å˜é‡
    // println!("{}", s1);

    // ------------------------ å…‹éš† -----------------------------
    // å…¶å®ä¹Ÿå°±æ˜¯æ·±æ‹·è´
    let s3 = s2.clone();
    // æ·±æ‹·è´åè¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ s2
    println!("{}", s2);

    let tup1 = (0, 0);
    let tup2 = tup1;
    // è¿˜æ˜¯å¯ä»¥è®¿é—® tup1ï¼Œå› ä¸º (i32, i32) ç±»å‹å®ç°äº† copy trait
    println!("{}", tup1.1);
    // å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Copy traitï¼Œé‚£ä¹ˆä¸€ä¸ªæ—§çš„å˜é‡åœ¨å°†å…¶èµ‹å€¼ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ã€‚
    // Rust ä¸å…è®¸è‡ªèº«æˆ–å…¶ä»»ä½•éƒ¨åˆ†å®ç°äº† Drop trait çš„ç±»å‹ä½¿ç”¨ Copy traitã€‚
    // ä»»ä½•ç®€å•çš„æ ‡é‡å’Œæ ‡é‡çš„ç»„åˆéƒ½å®ç°äº† copy trait

    let str_tup1 = (1, String::from("666"));
    let str_tup2 = str_tup1;
    // æŠ¥é”™ï¼Œstr_tup1 å®ç°äº† drop trait æ‰€ä»¥ä¸èƒ½å®ç° copy trait
    // println!("{}", str_tup1.0);

    // ------------------------ æ‰€æœ‰æƒä¸å‡½æ•° -----------------------------
    // å‡½æ•°ä¼ å‚å…¶å®å’Œèµ‹å€¼æ˜¯ä¸€æ ·çš„è¡Œä¸ºï¼Œå¯èƒ½ä¼šå‘ç”Ÿèµ‹å€¼æˆ–è€…ç§»åŠ¨
    fn add(a: i32, b: i32) -> i32 {
        a + b
    }
    let a = 1;
    let b = 2;
    // å­˜æ”¾æ ˆä¸Šçš„å˜é‡ a, b éƒ½æ˜¯å‘ç”Ÿèµ‹å€¼
    add(a, b);

    fn print_length(s: String) {
        println!("{}", s);
    }

    let ss = String::from("ss");
    print_length(ss);
    // æŠ¥é”™ï¼Œss åœ¨ä¸Šé¢ä¼ å‚çš„æ—¶å€™å·²ç»å‘ç”Ÿäº†ç§»åŠ¨
    // println!("{}", ss);

    // å‡½æ•°è¿”å›å€¼ä¹Ÿå¯ä»¥å‘ç”Ÿç§»åŠ¨
    fn borrow_then_back(s: String) -> String {
        s
    }

    let ss1 = String::from("ss1");
    // è¿™é‡Œå‘ç”Ÿäº†å•¥ï¼Ÿ
    // 1. å°† ss1 æ‰€æœ‰æƒè½¬ç§»ç»™äº† å‡½æ•°å‚æ•° s, ss1 å¤±æ•ˆ
    // 2. é€šè¿‡å‡½æ•°è¿”å›å€¼æŠŠå€Ÿå‡ºå»çš„æ‰€æœ‰æƒè¿˜å›ç»™äº† ss2
    let ss2 = borrow_then_back(ss1);
    // borrow of moved value: `ss1` value borrowed here after move
    // println!("{}", ss1);

    // æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…ƒç»„æ¥è¿”å›å¤šä¸ªå€¼
    fn get_origin() -> (i32, i32) {
        (0, 0)
    }

    // ------------------------ å¼•ç”¨å’Œå€Ÿç”¨ -----------------------------
    fn calculate_len(s: &String) -> usize {
        // å£°æ˜ä¸€ä¸ªå¼•ç”¨ç±»å‹å°±æ˜¯ &Type
        // s å¼•ç”¨ä¼ è¿›æ¥çš„ s3 å¹¶æ²¡æœ‰è½¬ç§»æ‰€æœ‰æƒ
        s.len()
    } // s ç¦»å¼€ä½œç”¨åŸŸåªä¼šå¼¹å‡ºæ ˆé¡¶çš„ s å¼•ç”¨æœ¬èº«ï¼Œä¸ä¼šå›æ”¶ s3, å› ä¸º s å¹¶ä¸æ˜¯ s3 çš„ owner
    let s3 = String::from("s3");
    calculate_len(&s3);
    // å¯ä»¥ç»§ç»­ä½¿ç”¨ s3, owner è¿˜æ˜¯ s3
    println!("{}", s3);

    // å¼•ç”¨æ˜¯åè¯ï¼Œå€Ÿç”¨æ˜¯åŠ¨è¯
    // We call the action of creating a reference borrowing

    //  &Type å£°æ˜çš„æ˜¯ä¸å¯å˜å¼•ç”¨
    fn change_1(s: &String) {
        // `s` is a `&` reference, so the data it refers to cannot be borrowed as mutable
        // s.push_str(", world!");
    }

    fn change_2(s: &mut String) {
        s.push_str(", world!");
    }
    let mut hello = String::from("hello");
    change_2(&mut hello);
    println!("{}", hello);

    let s4 = String::from("s4");
    // ä¸€ä¸ªå˜é‡å¯ä»¥æœ‰æ— æ•°ä¸ªä¸å¯å˜å¼•ç”¨
    let r1 = &s4;
    let r2 = &s4;

    // rust ä¸å…è®¸åŒæ—¶ä½¿ç”¨å¤šä¸ªå¯å˜å¼•ç”¨
    let mut s5 = String::from("s5");
    let mutable_r1 = &mut s5;
    let mutable_r2 = &mut s5;
    // ç”¨äº†å°±ä¼šæŠ¥é”™ï¼šcannot borrow `s5` as mutable more than once at a time
    // println!("{}", mutable_r1);

    // rust ä¸å…è®¸åŒæ—¶ä½¿ç”¨æŒ‡å‘åŒä¸€ä¸ªå˜é‡çš„ä¸å¯å˜å¼•ç”¨å’Œå¯å˜å¼•ç”¨
    let mut s6 = String::from("s6");
    let s6_ref = &s6;
    let s6_mutable_ref1 = &mut s6;
    // åŒæ—¶ä½¿ç”¨å¯å˜å’Œä¸å¯å˜å¼•ç”¨å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ç«äº‰
    // println!("{}{}",s6_ref,  s6_mutable_ref1);

    // ä¸å…è®¸åŒæ—¶ä½¿ç”¨å¤šä¸ªå¯å˜å¼•ç”¨æˆ–è€…åŒæ—¶åŒæ—¶å¯å˜ä¸ä¸å¯å˜å¼•ç”¨çš„åŸå› ï¼šrust æƒ³è¦åœ¨ç¼–è¯‘æœŸé—´å°±èƒ½é¿å…å‘ç”Ÿæ•°æ®ç«äº‰
    // æˆ‘ç†è§£æ•°æ®ç«äº‰åº”è¯¥å°±æ˜¯å¹¶å‘å®‰å…¨çš„æ„æ€

    // æ•°æ®ç«äº‰å‘ç”Ÿçš„æ¡ä»¶
    // 1. åŒæ—¶å­˜åœ¨ 1 ä¸ªä»¥ä¸Šçš„å¼•ç”¨
    // 2. è‡³å°‘æœ‰ä¸€ä¸ªå˜é‡æœ‰æƒè®¿é—®å˜é‡
    // 3. æ²¡æœ‰å…¶å®ƒæœºåˆ¶ç”¨äºç®¡ç†åŒæ­¥è®¿é—®ï¼ˆä¾‹å¦‚ java ä¸­å¯ä»¥ç”¨é”ï¼‰

    // å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª scoop æ¥ä½¿ç”¨å¤šä¸ªå¯å˜å¼•ç”¨
    {
        // è¿™ç§æƒ…å†µæ˜æ˜¾ä¸ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ï¼ŒåŒæ­¥æ‰§è¡Œä»£ç 
        let s6_mutable_ref2 = &mut s6;
        println!("{}", s6);
    }

    // å¼•ç”¨çš„ä½œç”¨åŸŸèŒƒå›´æ˜¯å£°æ˜å¼•ç”¨çš„åœ°æ–¹åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨å®ƒçš„åœ°æ–¹
    let mut good = String::from("å¥½");
    let good_ref = &good;
    println!("{}", good_ref); // æœ€åä¸€æ¬¡ä½¿ç”¨ good_ref åœ¨è¿™ï¼Œä½œç”¨åŸŸç»“æŸ

    let good_mut_ref = &mut good;
    println!("{}", good);

    // rust ç¼–è¯‘å™¨èƒ½å¤Ÿä¿è¯å¼•ç”¨æ˜¯å¯ç”¨çš„ï¼Œä¸ä¼šå‡ºç°åƒ c++ ä¸­çš„æ‚¬ç©ºæŒ‡é’ˆæˆ–è€…è¯´é‡æŒ‡é’ˆ
    // fn get_ref() -> &String {
    //     let s = String::form("xx");
    //     &s
    // } // s å‡ºäº†ä½œç”¨åŸŸå°±é”€æ¯äº†, è¿”å›çš„å¼•ç”¨å°±æ‚¬ç©ºäº†
    // è¿™é‡Œå¯ä»¥ç›´æ¥è¿”å› sï¼Œé€šè¿‡è¿”å›å€¼è½¬ç§»æ‰€æœ‰æƒ
    // his function's return type contains a borrowed value, but there is no value for it to be borrowed from

    // ------------------------ åˆ‡ç‰‡ -----------------------------

    println!("{}", "æˆ‘".as_bytes().len()); // 3
    println!("{}", "a".as_bytes().len()); // 1
    println!("{}", "ğŸš€".as_bytes().len()); // 4

    /// è¿”å›å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå•è¯
    /// å¯ä»¥è®¤ä¸ºå•è¯å‰é¢æ²¡æœ‰ç©ºæ ¼ï¼Œè¿”å›ç¬¬ä¸€ä¸ªå•è¯æ‰€åœ¨ä¸‹æ ‡ + 1
    fn find_word(s: &String) -> usize {
        for (i, &item) in s.as_bytes().iter().enumerate() {
            if (item == b' ') {
                return i;
            }
        }
        return s.len();
    }
    // è¿”å›ä¸‹æ ‡çš„æ–¹å¼å…¶å®ä¸å¤ªå®‰å…¨ï¼Œå› ä¸ºå¯èƒ½å­—ç¬¦ä¸²å†…å®¹è¢«ä¿®æ”¹ï¼Œç´¢å¼•å¤±æ•ˆ

    let s7 = String::from("Hello world!");
    println!("{}", find_word(&s7));

    let s8 = String::from("Pine apple");
    // åˆ‡ç‰‡æœ¬è´¨å°±æ˜¯å¼•ç”¨ï¼Œåªä¸è¿‡å¸¦èŒƒå›´
    let slice = &s8[..];

    // è¿”å›åˆ‡ç‰‡é¿å…å­—ç¬¦ä¸²è¢«ä¿®æ”¹
    fn first_word1(s: &String) -> &str {
        let bytes = s.as_bytes();

        for (i, &item) in bytes.iter().enumerate() {
            if item == b' ' {
                return &s[0..i];
            }
        }

        &s[..]
    }

    {
        let mut s = String::from("hello world");

        first_word1(&s);

        s.clear(); // é”™è¯¯!

        // println!("the first word is: {}", word);
    }

    // å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œä¸å¯å˜å¼•ç”¨ï¼Œæ‰€ä»¥ä¸å¯ä¿®æ”¹
    // ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡åšç±»å‹å‚æ•°æ¯”ä½¿ç”¨ &String æ›´é€šç”¨
    // å½“ä½ å§ &String ä¼ ç»™å­—ç¬¦ä¸²åˆ‡ç‰‡å‚æ•°æ—¶å‘ç”Ÿäº†ç±»å‹è½¬æ¢

    // å¾ˆå¤šé›†åˆç±»å‹éƒ½æœ‰åˆ‡ç‰‡
    let arr = [1, 2, 3];
    // ç±»å‹ç­¾å &[i32; 3]
    let arr_ref = &arr;
    // ç±»å‹ç­¾å &[i32]
    let arr_slice = &arr[0..1];
    println!("{}", arr_slice[1]);

    let mut string1 = String::from("xxx");
    let string_ref = &string1;
    let string_slice = & mut string1[..];

    /*
    æ€»çš„æ¥è¯´ï¼š
    1. æ‰€æœ‰æƒæœºåˆ¶ä¿è¯äº†å˜é‡åœ¨è„±ç¦»äº†ä½œç”¨åŸŸåå†…å­˜è¢«å›æ”¶
    2. å¼•ç”¨é™åˆ¶ä¿è¯äº†ä¸ä¼šå‘ç”Ÿæ•°æ®ç«äº‰å’Œè®¿é—®æ‚¬ç©ºæŒ‡é’ˆ
    3. åˆ‡ç‰‡å·¥å…·è®©æˆ‘ä»¬åœ¨æ•°æ®å®‰å…¨è®¿é—®æ›´è¿›ä¸€æ­¥ï¼Œå¯ä»¥è®¿é—®é›†åˆçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”ä¸ä¼šå‘ç”Ÿæ•°æ®ç«äº‰
     */
}
